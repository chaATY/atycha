---
title: Intel汇编-通用寄存器
date: 2023-11-01 14:29
author: CHA.ATY
environment:
  - Windows10-22H2_19045.3570
tags:
  - Intel汇编
---

# 一、前言

本文描述基本的 32 位 X86 汇编语言的寄存器结构，寄存器主要用于存储和处理数据。

---

# 二、寄存器

现代 x86 处理器有 8 个 32bit 寄存器，寄存器名字是早期计算机历史上流传下来的。例如，EAX 表示 Accumulator，因为它用作算术运算的累加器，ECX 表示 Counter，用来存储循环变量（计数）。大部分寄存器的名字已经失去了原来的意义，但有 两个是例外：栈指针寄存器（Stack Pointer）ESP 和基址寄存器（ Base Pointer）EBP。

对于 `EAX`, `EBX`, `ECX`, `EDX` 四个寄存器，可以再将 32bit 划分成多个子寄存器，每个子寄存器有专门的名字。例如 `EAX` 的高 16bit 叫 `AX`，低 8bit 叫 `AL`，8-16bit 叫 `AH`。如下表所示：

|31 ~ 16|15 ~ 0|15 ~ 8|7 ~ 0|
|---|---|---|---|
|32位|16位|8位|8位|
|EAX|AX|AH|AL|
|ECX|CX|CH|CL|
|EDX|DX|DH|DL|
|EBX|BX|BH|BL|
|ESP|SP|||
|EBP|BP|||
|ESI|SI|||
|EDI|DI|||

在汇编语言中，这些寄存器的名字是**大小写无关**的，既可以用 `EAX`，也可以写 `eax`。

---

# 三、通用寄存器

32位通用寄存器的指定用途如下：

|寄存器|主要用途|编号|存储数据的范围|
|---|---|---|---|
|EAX|累加寄存器，常用于算数运算、布尔操作、逻辑操作、返回函数结果等|0|0 - 0xFFFFFFFF|
|ECX|计数寄存器，常用于存放循环语句的循环次数，字符串操作中也常用|1|0 - 0xFFFFFFFF|
|EDX|数据寄存器，常常和EAX一起使用，I/O指针|2|0 - 0xFFFFFFFF|
|EBX|基址寄存器，常用于存档内存地址，DS段的数据指针|3|0 - 0xFFFFFFFF|
|ESP|堆栈指针，指向当前栈帧的栈顶（底地址）|4|0 - 0xFFFFFFFF|
|EBP|SS段的数据指针，指向当前栈帧的栈底（高地址）|5|0 - 0xFFFFFFFF|
|ESI|字符串操作的源指针；SS段的数据指针|6|0 - 0xFFFFFFFF|
|EDI|字符串操作的目标指针；ES段的数据指针|7|0 - 0xFFFFFFFF|

栈帧：就是ESP -> EBP 之间的空间，通常是调用函数时，函数的参数，从一个函数切换到另一个函数上，栈帧也会发生变化，当函数调用结束后，则需要平栈帧，不然会发生访问冲突，平栈帧的过程都是有编译器来解决的。

---

# 四、指针寄存器

80386 的指针寄存器有基址寄存器 EBP，堆栈指针寄存器 ESP 和指令指针寄存器 EIP。只需要了解基址寄存器 EBP 和堆栈指针寄存器 ESP 即可，指令指针寄存器 EIP 总是指向下一条要执行的指令的地址，一般情况下无需修改 EIP。

程序指针寄存器EIP(Extended Instruction Pointer)，指向CPU要执行的下一条指令。

|寄存器|主要用途|编号|存储数据的范围|
|---|---|---|---|
|ESP|堆栈指针寄存器，指向当前栈帧的栈顶（底地址），不可作为通用寄存器使用，一般情况下，ESP和EBP联合使用来访问函数中的参数和局部变量|4|0 - 0xFFFFFFFF|
|EBP|基址寄存器，SS段的数据指针，指向当前栈帧的栈底（高地址），可作为通用寄存器用于存放操作数，常用来代替堆栈指针访问堆栈中的数据|5|0 - 0xFFFFFFFF|
|EIP|堆栈指针寄存器，指令指针寄存器EIP总是指向下一条要执行的指令的地址|?|?|

EBP 和 ESP 常配合使用完成堆栈的访问，下面是一段常见的堆栈访问指令。

```x86asm
Push ebp
Mov ebp,esp
Sub esp,78
Push esi
Push edi
```

---

# 五、变址寄存器

变址寄存器，变址的含义是内存地址会变动的，也就是说变址寄存器中存放在变动的内存地址。

80386架构中有两个变址寄存器，分别是 ESI 和 EDI。

|寄存器|主要用途|编号|存储数据的范围|
|---|---|---|---|
|ESI|源变址寄存器，通常存放要处理的数据的内存地址：字符串操作的源指针、SS段的数据指针|6|0 - 0xFFFFFFFF|
|EDI|目的变址寄存器，通常存放处理后的数据的内存地址：字符串操作的目标指针、ES段的数据指针|7|0 - 0xFFFFFFFF|

ESI 和 EDI 常用来配合使用完成数据的赋值操作，下面是一个 ESI 和 EDI 配合使用的例子：
```x86asm
// 下面的指令把ESI所指向的内存地址中的内容复制到EDI所指向的内存中，数据的长度在ECX寄存器
Rep movs dword ptr [edi],dword ptr [esi]
```

---

# 六、64位寄存器

8个新的通用寄存器R8～R15：可以分别使用RnD、RnW、RnL（n= 8～15）来引用这些寄存器的低32位、低16位或低8位。

8个新的SIMD寄存器XMM8～XMM15。

控制寄存器CR8，又称为任务优先级寄存器（Task  PriorityRegister）。

Extended-Feature-Enable  Register（EFER）寄存器：用来启用扩展的CPU功能，其作用与标志寄存器类似。

WinDBG r命令操作的是在中断到调试器时被调试程序保存在内存中的寄存器上下文，而

rdmsr和wrmsr操作的是CPU内部的物理寄存器。

---

> 版权声明©：
>
> 本文为 CHA.ATY 的原创文章，遵循 [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) 许可证进行授权，转载请附上原文出处链接及本声明。
>
> 作者：CHA.ATY
>
> 邮箱：2165150141@qq.com